Tarefa 06: Refatorar authService.ts (Frontend)
Objetivo: Modificar o authService.ts para que ele pare de usar a lógica antiga (que tentava ligar ao /login do IXC) e passe a usar a nova arquitetura (ligar ao POST /api/auth/login do nosso backend no Render).

Contexto: Esta é a continuação da Tarefa 05. O constants/config.ts e o services/ixcApi.ts (agora api.ts) já foram refatorados para apontar para o nosso backend. Agora, vamos fazer o serviço de login usar essa nova configuração.

Modificações no seu services/authService.ts
Instruções: Abra o seu ficheiro services/authService.ts. Substitua o conteúdo inteiro desse ficheiro por este novo código.

TypeScript

// Em: services/authService.ts
//
// 1. APAGUE todo o conteúdo antigo.
// 2. COLE este novo código.
//
// Este ficheiro foi simplificado. Ele agora usa o 'api.ts' 
// (que fala com o nosso backend) em vez do 'ixcApi.ts'.

import { api } from './ixcApi'; // (Mantive o nome 'ixcApi' para não quebrar outros imports)
import { API_CONFIG } from '@/constants/config';
import type { AuthUserData, IXCLoginRequest } from '@/types/ixc';

export const authService = {
  
  /**
   * Função de login real.
   * Agora chama o *nosso backend* no Render, que faz o trabalho sujo no IXC.
   */
  async login(credentials: IXCLoginRequest): Promise<AuthUserData> {
    try {
      // 1. Chama o NOVO endpoint de login do *nosso backend*
      const response = await api.post<AuthUserData & { token: string }>(
        API_CONFIG.ENDPOINTS.LOGIN, // Chama '/api/auth/login'
        credentials
      );

      // 2. O backend (server.js) retorna o nosso Token JWT e os dados do user
      if (response.token) {
        // 3. Salvamos o Token JWT no AsyncStorage
        await api.setToken(response.token);
      }
      
      // 4. Retorna os dados do utilizador para o AuthContext
      return response;

    } catch (error) {
      if (error instanceof Error) {
        throw new Error(`Erro no login: ${error.message}`);
      }
      throw new Error('Erro desconhecido ao fazer login');
    }
  },

  /**
   * O Logout agora limpa o nosso Token JWT
   */
  async logout() {
    await api.clearToken();
  },

  /**
   * Mantemos o mockLogin para testes offline.
   * (Esta é a função que está a ser chamada agora)
   */
  async mockLogin(email: string, senha: string): Promise<AuthUserData> {
    await new Promise(resolve => setTimeout(resolve, 1000));

    if (email === 'test@fibernet.com' && senha === '123456') {
      const mockResponse: AuthUserData = {
        id_cliente: '123',
        id_contrato: '12345',
        nome_cliente: 'João Silva (Mock)',
        email: 'test@fibernet.com',
        telefone: '(11) 99999-9999',
        status_contrato: 'Ativo',
      };
      
      // Simula o salvamento de um token falso
      await api.setToken('mock-jwt-token');
      return mockResponse;
    }

    throw new Error('E-mail ou senha inválidos');
  },
};