Perfeito. Se o seu backend (server.js) j√° est√° configurado e a funcionar no Render com as 3 vari√°veis de ambiente (IXC_API_URL, IXC_ADMIN_TOKEN, JWT_SECRET), o pr√≥ximo passo √© refatorar o seu aplicativo (AplicativoFIber).

Vamos agora fazer o aplicativo parar de tentar falar com o IXC e faz√™-lo falar apenas com o seu novo backend no Render.

Seguindo o seu modelo, esta √© a pr√≥xima tarefa.

Tarefa 05: Refatorar Configura√ß√£o da API (Frontend)
Objetivo: Simplificar o constants/config.ts e o services/ixcApi.ts para que o aplicativo comunique-se exclusivamente com o seu novo backend (hospedado no Render).

Contexto: O seu server.js agora √© o nosso proxy (intermedi√°rio). O aplicativo n√£o precisa mais de saber o Token de Admin do IXC ou a URL do IXC. Ele s√≥ precisa de saber a URL do seu backend (ex: https://api.centralfiber.online).

1. Modifica√ß√£o em constants/config.ts
Instru√ß√µes: Abra o seu ficheiro constants/config.ts. Substitua o conte√∫do inteiro desse ficheiro por este c√≥digo simplificado.

TypeScript

// Em: constants/config.ts
//
// 1. APAGUE todo o conte√∫do antigo.
// 2. COLE este novo c√≥digo.
//
// Agora s√≥ precisamos de UMA URL base: a do nosso backend no Render.
// Todas as outras configura√ß√µes (Tokens do IXC, URLs do GenieACS)
// agora vivem APENAS no backend.

/**
 * A URL principal do seu backend (hospedado no Render).
 * * üõë IMPORTANTE: Substitua pela sua URL p√∫blica do Render.
 */
const API_BASE_URL = 'https://api.centralfiber.online'; // <-- COLOQUE A SUA URL DO RENDER AQUI

// Exportamos as rotas que o app vai consumir do *nosso* backend
export const API_CONFIG = {
  BASE_URL: API_BASE_URL,
  
  ENDPOINTS: {
    // Rotas de Autentica√ß√£o
    LOGIN: '/api/auth/login',      // O novo endpoint de login que cri√°mos no backend

    // Rotas do IXC (que o backend agora faz o proxy)
    // (Vamos ter de criar estas rotas no backend a seguir)
    INVOICES: '/api/invoices',
    CONTRACTS: '/api/contracts',
    BOLETO: '/api/boleto',
    SUPPORT: '/api/support',

    // Rotas de Servi√ßos
    ONT: '/api/ont',               // O endpoint do GenieACS
    BOT: '/api/bot',               // O endpoint do FiberBot/Gemini
    SPEEDTEST: '/api/speedtest',   // O endpoint do Speedtest
  }
};
2. Modifica√ß√£o em services/ixcApi.ts
Instru√ß√µes: Abra o seu ficheiro services/ixcApi.ts. Substitua o conte√∫do inteiro por esta nova vers√£o.

(Esta nova vers√£o vai usar o API_CONFIG que acab√°mos de criar e vai guardar o Token JWT [gerado pelo nosso backend] no AsyncStorage, em vez do token do IXC.)

TypeScript

// Em: services/ixcApi.ts
// (Substitua o ficheiro inteiro por este)

import axios, { AxiosInstance, AxiosRequestConfig } from 'axios';
import { API_CONFIG } from '@/constants/config';
import AsyncStorage from '@react-native-async-storage/async-storage';

// Chave para guardar o nosso Token JWT no telem√≥vel
const TOKEN_STORAGE_KEY = '@FiberApp:authToken';

class ApiClient {
  private api: AxiosInstance;

  constructor() {
    this.api = axios.create({
      baseURL: API_CONFIG.BASE_URL, // Usa a URL do nosso backend
      headers: {
        'Content-Type': 'application/json',
      },
      timeout: 10000,
    });

    // Esta parte (Interceptor) √© crucial.
    // Ela adiciona o Token JWT (que o *nosso* backend gerou)
    // em TODAS as requisi√ß√µes futuras (faturas, contratos, etc.)
    this.api.interceptors.request.use(async (config) => {
      const token = await AsyncStorage.getItem(TOKEN_STORAGE_KEY);
      if (token) {
        // Envia o "Bearer Token" que o backend entende
        config.headers.Authorization = `Bearer ${token}`;
      }
      return config;
    }, (error) => {
      return Promise.reject(error);
    });
  }

  /**
   * Fun√ß√£o para salvar o Token JWT (recebido do /api/auth/login)
   */
  public async setToken(token: string): Promise<void> {
    await AsyncStorage.setItem(TOKEN_STORAGE_KEY, token);
  }

  /**
   * Fun√ß√£o para limpar o Token JWT no logout
   */
  public async clearToken(): Promise<void> {
    await AsyncStorage.removeItem(TOKEN_STORAGE_KEY);
  }

  // M√©todos de requisi√ß√£o (n√£o precisamos mais do 'postList')
  public async get<T = any>(endpoint: string, config?: AxiosRequestConfig): Promise<T> {
    const response = await this.api.get(endpoint, config);
    return response.data;
  }

  public async post<T = any>(endpoint: string, data: any, config?: AxiosRequestConfig): Promise<T> {
    const response = await this.api.post(endpoint, data, config);
    return response.data;
  }
  
  // (Pode adicionar PUT, DELETE, etc. se necess√°rio)
}

/**
 * ATEN√á√ÉO: Renome√°mos 'ixcApi' para 'api'.
 * * Isto √© o nosso novo cliente de API unificado que fala
 * APENAS com o nosso backend.
 */
export const api = new ApiClient();